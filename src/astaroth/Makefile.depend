AC_INCLUDE=submodule/include
AC_STANDALONE=submodule/src/standalone
AC_CORE=submodule/src/core
AC_HEADERS=$(AC_INCLUDE)/astaroth.h submodule/acc-runtime/api/math_utils.h

# C headers in src 
CHEADERS = ../cparam_c.h ../cdata_c.h ../sub_c.h ../headers_c.h ../forcing_c.h ../boundcond_c.h ../mpicomm_c.h

PC_HEADERS = $(PCHEADER_DIR)/PC_module_parfuncs.h $(PCHEADER_DIR)/PC_modulepars.h $(PCHEADER_DIR)/PC_modulepardecs.h $(PCHEADER_DIR)/PC_module_diagfuncs.h $(PCHEADER_DIR)/PC_modulediags.h $(PCHEADER_DIR)/PC_modulediags_init.h

gpu_astaroth.o: gpu_astaroth.cc $(AC_HEADERS) $(PCHEADER_DIR)/PC_moduleflags.h $(PCHEADER_DIR)/PC_module_parfuncs.h forcing.h loadStore.h $(CHEADERS) astaroth_libs
	mkdir -p build && \
	echo $(USE_HIP) && \
	echo $(CMAKE_PREC) && \
	cd build && \
	cmake -D$(CMAKE_PREC) -DUSE_HIP=$(USE_HIP) .. && \
	make -j && \
	cd .. && \
	cp ./build/libastaroth.so libastaroth.so && \
	cp libastaroth.so astaroth_sgl.so && \
	cp libastaroth.so astaroth_dbl.so && \
	mkdir -p scheduler-build && \
	cd scheduler-build && \
	cmake -DUSE_OPENMP=ON ../NUMA-scheduler && \
	make -j && \
	cd .. && \
	cp -r ./NUMA-scheduler/include .

